---
title: Beanstalk Flashloan Exploit
author: bemodest.eth
date: 2022-04-18 00:00:00 +0900
categories: [Crypto, DeFi, Thoughts]
tags: [defi, thoughts]
image:
  path: posts/0418_1.png
  width: 500
  alt: A single transaction blows up hundreds of thousands of $
---

### *취미생활방 서포터즈 활동으로 작성된 게시글입니다.
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　    
## 🔎 Beanstalk Farm 개요
• 이더리움 네트워크의 신용 기반 스테이블코인 프로토콜

• 담보 없이 신용을 통한 공급/이자율 조절로 $1을 유지

• TVL:[4월 16일 기준 약 150m(1800억)](https://twitter.com/BeanstalkFarms/status/1515123454676070400?s=20&t=sOOhrskDy2aFh_VbuGsqoA)

## 🔎 BEAN 플래시론 공격
• 한국 시각 기준 4월 17일 22시에 플래시론 공격으로 프로토콜의 모든 자산이 유출됨

• 공격으로 인해 BEAN 가격이 $1에서 붕괴함 [BEAN 가격](https://www.coingecko.com/en/coins/bean)

## 💡 플래시론?
플래시론은 블록 하나가 만들어지는 시간 내에 대출과 상환을 모두 진행하는 대출 방식이다. 수수료를 제외한 어떠한 담보도 요구하지 않기 때문에 "담보 없는 대출"이라고도 한다.

플래시론의 핵심은 대출 거래과 MARK상환 거래 사이에 수많은 거래를 집어넣어 시장을 조작하고 차익을 얻는 것이다. 그리고 이 모든 과정이 하나의 블록 안에서 눈 깜짝할 새 이루어진다. [플래시론에 대한 설명 아티클](https://academy.binance.com/ko/articles/what-are-flash-loans-in-defi)

## 💡 플래시론 전개 과정
0. 공격 하루 전 [우크라이나에 250k BEAN(25만 달러)을 기부하자는 가짜 거버넌스 의제 (BIP-18)을 만듦](https://etherscan.io/tx/0xd09b72275962b03dd96205f8077fdc08bec87c0ebd07e431aadc760f31f34b01). 보통 의제처럼 보이지만 프로토콜의 모든 자산을 공격자 지갑으로 옮기는 call이 숨겨져 있음
1. 커브, 스시스왑, 유니스왑에서 스테이블과 BEAN을 플래시론으로 대출
2. 플래시론으로 얻은 자산을 커브에 예치해 Beanstalk DAO의 거버넌스 파워 획득
3. 빌린 거버넌스 파워를 집중해 BIP-18을 바로 통과시킴
4. 프로토콜의 자금이 공격자 지갑으로 이동
5. 4번 과정에서 의제대로 25만 달러를 우크라이나에 기부
6. 커브 예치금을 빼고 플래시론 대출금 상환
7. 남은 돈은 이더리움으로 스왑해 토네이도 캐시로 송금

Beanstalk DAO에는 '긴급 통과'리는 개념이 있어서 절대다수(67% 이상)가 해당 의제를 지지하면 그 의제를 바로 통과시킬 수 있다. 공격자는 이를 악용해 플래시론으로 잠깐동안 거버넌스 파워를 모으고, 한 의제에 이를 집중해 의제를 바로 통과시킬 수 있었다.

위의 1~6 과정이 단 몇 초만에 진행되었다. 그리고 그 결과 공격자는 약 24800ETH(937억 원)를 얻었고, Beanstalk의 모든 자금 (약 $150m, 1800억 원)이 유출됐다. 피해 금액이 공격자가 얻은 돈보다 많은 이유는 플래시론 과정에서 BEAN의 가치가 추락했기 때문이다.

## 🔎 정리 & 의견
Beanstalk 자체는 새로운 스테이블코인 메커니즘과 높은 이자 수익으로 인기를 끌고 있었다. 그러나 이번 플래시론 공격으로 프로토콜이 거의 붕괴했고 Beanstalk의 투자자들도 큰 손해를 입었다. [현재 팀은 팀의 신상을 공개하고 FBI와 연락을 취하고 있다.](https://discord.com/channels/880413392916054098/880500642546851850/965496314244775976)

플래시론은 어떠한 개미도 몇 초 동안은 고래처럼 시장을 조작할 수 있는 힘을 준다. 그리고 플래시론을 이용한 공격을 거치면서 DeFi 생태계는 허점을 고치고 더 성숙해진다.

반면에 플래시론은 DeFi 프로토콜의 취약점과 허점을 이용한다는 점, 이익을 얻는 과정에서 공격 대상이 되는 프로젝트와 해당 프로젝트의 투자자들이 큰 피해를 본다는 점에서 하나의 해킹으로도 볼 수 있을 것이다.

[Peckshield 스레드](https://twitter.com/peckshield/status/1515680335769456640) | [오딧 리포트](https://medium.com/@omniscia.io/beanstalk-farms-post-mortem-analysis-a0667ee0ca9d)
